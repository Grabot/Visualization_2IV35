<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>2IV35 Assignment 3</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- D3 Libary -->
    <script src="js/d3.js" charset="utf-8"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <h1>Inflamation</h1>

        <div class="row">
            <div class="col-md-8">
                <div class="graph_parallelcoordinates">
                </div>
            </div>
            <div class="col-md-4">.col-md-4</div>
        </div>
    </div>

    <script type="text/javascript">

        var species = ["setosa", "versicolor", "virginica"],
            traits = ["sepal length", "petal length", "sepal width", "petal width"];

        var m = [80, 160, 200, 160],
            w = 1280 - m[1] - m[3],
            h = 800 - m[0] - m[2];

        var x = d3.scale.ordinal().domain(traits).rangePoints([0, w]),
            y = {};

        var line = d3.svg.line(),
            axis = d3.svg.axis().orient("left"),
            foreground;

        var svg = d3.select(".graph_parallelcoordinates").append("svg:svg")
            .attr("width", w + m[1] + m[3])
            .attr("height", h + m[0] + m[2])
          .append("svg:g")
            .attr("transform", "translate(" + m[3] + "," + m[0] + ")");


        d3.text("data/inflammation.csv", function (row) {
            //console.log(text);

            var data = d3.tsv.parseRows(text).map(row);
            console.log(data);
        });

        d3.csv("data/iris.csv", function (flowers) {

            // Create a scale and brush for each trait.
            traits.forEach(function (d) {
                // Coerce values to numbers.
                flowers.forEach(function (p) { p[d] = +p[d]; });

                y[d] = d3.scale.linear()
                    .domain(d3.extent(flowers, function (p) { return p[d]; }))
                    .range([h, 0]);

                y[d].brush = d3.svg.brush()
                    .y(y[d])
                    .on("brush", brush);
            });

            // Add a legend.
            var legend = svg.selectAll("g.legend")
                .data(species)
              .enter().append("svg:g")
                .attr("class", "legend")
                .attr("transform", function (d, i) { return "translate(0," + (i * 20 + 584) + ")"; });

            legend.append("svg:line")
                .attr("class", String)
                .attr("x2", 8);

            legend.append("svg:text")
                .attr("x", 12)
                .attr("dy", ".31em")
                .text(function (d) { return "Iris " + d; });

            // Add foreground lines.
            foreground = svg.append("svg:g")
                .attr("class", "foreground")
              .selectAll("path")
                .data(flowers)
              .enter().append("svg:path")
                .attr("d", path)
                .attr("class", function (d) { return d.species; });

            // Add a group element for each trait.
            var g = svg.selectAll(".trait")
                .data(traits)
              .enter().append("svg:g")
                .attr("class", "trait")
                .attr("transform", function (d) { return "translate(" + x(d) + ")"; })
                .call(d3.behavior.drag()
                .origin(function (d) { return { x: x(d) }; })
                .on("dragstart", dragstart)
                .on("drag", drag)
                .on("dragend", dragend));

            // Add an axis and title.
            g.append("svg:g")
                .attr("class", "axis")
                .each(function (d) { d3.select(this).call(axis.scale(y[d])); })
              .append("svg:text")
                .attr("text-anchor", "middle")
                .attr("y", -9)
                .text(String);

            // Add a brush for each axis.
            g.append("svg:g")
                .attr("class", "brush")
                .each(function (d) { d3.select(this).call(y[d].brush); })
              .selectAll("rect")
                .attr("x", -8)
                .attr("width", 16);

            function dragstart(d) {
                i = traits.indexOf(d);
            }

            function drag(d) {
                x.range()[i] = d3.event.x;
                traits.sort(function (a, b) { return x(a) - x(b); });
                g.attr("transform", function (d) { return "translate(" + x(d) + ")"; });
                foreground.attr("d", path);
            }

            function dragend(d) {
                x.domain(traits).rangePoints([0, w]);
                var t = d3.transition().duration(500);
                t.selectAll(".trait").attr("transform", function (d) { return "translate(" + x(d) + ")"; });
                t.selectAll(".foreground path").attr("d", path);
            }
        });

        // Returns the path for a given data point.
        function path(d) {
            return line(traits.map(function (p) { return [x(p), y[p](d[p])]; }));
        }

        // Handles a brush event, toggling the display of foreground lines.
        function brush() {
            var actives = traits.filter(function (p) { return !y[p].brush.empty(); }),
                extents = actives.map(function (p) { return y[p].brush.extent(); });
            foreground.classed("fade", function (d) {
                return !actives.every(function (p, i) {
                    return extents[i][0] <= d[p] && d[p] <= extents[i][1];
                });
            });
        }

    </script>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
</body>
</html>
