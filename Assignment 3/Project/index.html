<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>2IV35 Assignment 3</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- D3 Libary -->
    <script src="js/d3.js" charset="utf-8"></script>

    <style>
        .foreground path {
            fill: none;
            stroke: black;
        }

        .foreground path:hover {
            fill: none;
            stroke: red;
            stroke-width:10;
        }
    </style>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <h1>Inflamation</h1>

        <div class="row">
            <div class="col-md-8" id="graph_parallelcoordinates"></div>
            <div class="col-md-4">.col-md-4</div>
        </div>
    </div>

    <script type="text/javascript">

        var symptoms = ["Temperature", "Nausea", "Lumbar pain", "Urine pushing", "Micturition pains", "Burning of urethra", "Inflamation of urinary bladder", "Nephritis"];

        var margin = { top: 150, right: 40, bottom: 30, left: 40 }
          , width = parseInt(d3.select('#graph_parallelcoordinates').style('width'), 0)
          , width = width - margin.left - margin.right;
        var height = (0.9 * width) - margin.top - margin.bottom;

        var x = d3.scale.ordinal().domain(symptoms).rangePoints([0, width]),
            y = {};

        var line = d3.svg.line(),
            axis = d3.svg.axis().orient("left"),
            foreground;

        var svg = d3.select("#graph_parallelcoordinates").append("svg:svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
          .append("svg:g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        // Read the data from file
        d3.text("data/inflammation.csv", function (text) {
            var data = d3.tsv.parseRows(text).map(function (row) {

                return row.map(function (value) {
                    if (value == "no") {
                        return 0;
                    } else if (value == "yes") {
                        return 1;
                    } else { return parseFloat(value.replace(",", ".")); }
                });
            });

            // Create a scale and brush for each trait.
            symptoms.forEach(function (d) {
                // Coerce values to numbers.
                var index = symptoms.indexOf(d);

                data.forEach(function (p) {
                    p[index] = +p[index];
                });

                y[d] = d3.scale.linear()
                    .domain(d3.extent(data, function (p) { return p[index]; }))
                    .range([height, 0]);

                y[d].brush = d3.svg.brush()
                    .y(y[d])
                .on("brush", brush);
            });

            // Add foreground lines.
            foreground = svg.append("svg:g")
                .attr("class", "foreground")
              .selectAll("path")
                .data(data)
              .enter().append("svg:path")
                .attr("d", path)
                .attr("class", function (d) { return d; });

            // Add a group element for each symptom.
            var g = svg.selectAll(".symptom")
                .data(symptoms)
              .enter().append("svg:g")
                .attr("class", "symptom")
                .attr("transform", function (d) { return "translate(" + x(d) + ")"; })
                .call(d3.behavior.drag()
                .origin(function (d) { return { x: x(d) }; })
                .on("dragstart", dragstart)
                .on("drag", drag)
                .on("dragend", dragend));

            // Add an axis and title.
            g.append("svg:g")
                .attr("class", "axis")
                .each(function (d) { d3.select(this).call(axis.scale(y[d])); })
              .append("svg:text")
                .attr("text-anchor", "start")
                .attr("y", -9)
                .attr("dx", "0.3em")
                .attr("dy", "-0.2em")
                .attr("transform", function (d) {
                    return "rotate(-65)"
                })
                .text(String);

            function dragstart(d) {
                i = symptoms.indexOf(d);
            }

            function drag(d) {
                x.range()[i] = d3.event.x;
                symptoms.sort(function (a, b) { return x(a) - x(b); });
                g.attr("transform", function (d) { return "translate(" + x(d) + ")"; });
                foreground.attr("d", path);
            }

            function dragend(d) {
                x.domain(symptoms).rangePoints([0, width]);
                var t = d3.transition().duration(500);
                t.selectAll(".symptom").attr("transform", function (d) { return "translate(" + x(d) + ")"; });
                t.selectAll(".foreground path").attr("d", path);
            }

        });

        // Returns the path for a given data point.
        function path(d) {
            return line(symptoms.map(function (p) {
                var index = symptoms.indexOf(p);
                return [x(p), y[p](d[index])];
            }));
        }


        // Handles a brush event, toggling the display of foreground lines.
        function brush() {
            var actives = symptoms.filter(function (p) { return !y[p].brush.empty(); }),
                extents = actives.map(function (p) { return y[p].brush.extent(); });
            foreground.classed("fade", function (d) {
                return !actives.every(function (p, i) {
                    return extents[i][0] <= d[p] && d[p] <= extents[i][1];
                });
            });
        }

    </script>


    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
</body>
</html>
