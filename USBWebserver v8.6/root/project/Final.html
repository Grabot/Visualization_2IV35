<!DOCTYPE html>
<html>
<head>
	<title>2IV35 Visualization</title>
</head>
<meta charset="utf-8">

<style>
	path {
	  stroke: grey;
	  stroke-width: 1px;
	}

	html
	{
	    -webkit-user-select: none;
	}

</style>

<body>

	<form name="MyForm">
	<input type="button" value="Select and Click" onclick="checkItem()"><br>
	<input type="radio" name="item" value="Apple">
	<label>Apple</label><br>
	<input type="radio" name="item" value="Orange">
	<label>Orange</label><br>
	<input type="radio" name="item" value="Grape">
	<label>Grape</label><br>
	<input type="radio" name="item" value="Melon">
	<label>Melon</label><br>
	</form>

	<hr size="1" />
	<div id="pie"></div>
	<div id="mapContainer"></div>
    <div id="chartContainer"></div>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script src="d3pie.min.js"></script>
	<script src="d3pie.js"></script>
	<script src="dimple.v2.1.0.js"></script>
	<script src="PieLoader.js"></script>
	<script src="ChartLoader.js"></script>
	<script>

	var width = 800,
		height = 800;

	var cityData = d3.map();

	var linearColorScale = d3.scale.linear()
		.domain([0.0, 100.0])
		.range(["white", "red"]);

	var svg = d3.select("#mapContainer").append("svg")
		.attr("width", width)
		.attr("height", height);

	var pie = drawPie([
		{ label: "not married", value: 43, caption: "people who are not married" },
		{ label: "married", value: 44, caption: "peopel who are married" },
		{ label: "divorced", value: 7, caption: "people who got divorced" },
		{ label: "widow", value: 6, caption: "people who are widowed" }
	]);

	// Setup the map projection for a good depiction of The Netherlands. The
	// projection is centered on the geographical center of the country, which
	// happens to be the city of Lunteren.
	var projection = d3.geo.albers()
		  .rotate([0, 0])
		  .center([5.6, 52.1])
		  .parallels([50, 53])
		  .scale(15000)
		  .translate([width/2, height/2]);

	var path = d3.geo.path().projection(projection);

	var population = [];

	var g = svg.append("g");

	var i = 0;
	
	var mapsettings = document.getElementById('mapContainer')
	mapsettings.style.position = "absolute";

	var chartData = [
        {"Age": "00-04", "Pecentage": 4.9},
        {"Age": "05-09", "Pecentage": 6.0},
        {"Age": "10-14", "Pecentage": 6.5},
        {"Age": "15-19", "Pecentage": 6.6},
        {"Age": "20-24", "Pecentage": 4.7},
        {"Age": "25-29", "Pecentage": 4.4},
        {"Age": "30-34", "Pecentage": 4.5},
        {"Age": "35-39", "Pecentage": 5.8},
        {"Age": "40-44", "Pecentage": 7.5},
        {"Age": "45-49", "Pecentage": 8.0},
        {"Age": "50-54", "Pecentage": 7.6},
        {"Age": "55-59", "Pecentage": 7.7},
        {"Age": "60-65", "Pecentage": 7.3},
        {"Age": "65-69", "Pecentage": 7.3},
        {"Age": "70-74", "Pecentage": 6.2},
        {"Age": "75-79", "Pecentage": 6.2},
        {"Age": "80-84", "Pecentage": 4.3},
        {"Age": "85-89", "Pecentage": 4.3},
        {"Age": "90-94", "Pecentage": 4.3},
        {"Age": "95-EO", "Pecentage": 3.3}
    ];

    var chart = drawChart( chartData );

    var chartsettings = document.getElementById('chartContainer')
	chartsettings.style.position = "absolute";
	chartsettings.style.left = "600px";
	chartsettings.style.top = "500px";

	queue()
	   .defer(d3.json, "cities-geometry.json")
	   .defer(d3.tsv, "cities-data.txt", function(d) 
	   	{

	   		population[i] = d;
	   		i++
	   		cityData.set(d.Code, +d.AUTO_TOT);
	   	})
	   .await(dataLoaded);

	function dataLoaded(error, mapData) 
	{
		var maxValue = d3.max(cityData.values());
		//console.log("The maximum value is " + maxValue);			
		linearColorScale.domain([0.0, maxValue]);
		
		g.selectAll("path")
		.data(mapData.features).enter()
		.append("path")
		.attr("d", path)
		.style("fill", function(d) { return linearColorScale(cityData.get(d.gm_code)); })
		.on("mouseover", function(){d3.select(this)
			.style("fill", "green");})
		.on("mouseout", function(){d3.select(this)
			.style("fill", function(d) { return linearColorScale(cityData.get(d.gm_code)); }); })
		.on("mousedown", cityClick)
		.append("title").text(function(d) {return d.gm_naam + ", " +
		cityData.get(d.gm_code); });

	}

	function cityClick(d) 
	{


		for( k = 0; k < population.length; k++ )
		{
			if( d.gm_code == population[k].GM_CODE)
			{
				//console.log( "what the dee says, naam: " + d.gm_naam + " code: " + d.gm_code);
				//console.log( "what the mee says, naam: " + population[k].GM_NAAM + " code: " + population[k].GM_CODE + " extra info: " + population[k].P_00_04_JR );

				chart.data = [
			        {"Age": "00-04", "Pecentage": population[k].P_00_04_JR },
			        {"Age": "05-09", "Pecentage": population[k].P_05_09_JR },
			        {"Age": "10-14", "Pecentage": population[k].P_10_14_JR },
			        {"Age": "15-19", "Pecentage": population[k].P_15_19_JR },
			        {"Age": "20-24", "Pecentage": population[k].P_20_24_JR },
			        {"Age": "25-29", "Pecentage": population[k].P_25_29_JR },
			        {"Age": "30-34", "Pecentage": population[k].P_30_34_JR },
			        {"Age": "35-39", "Pecentage": population[k].P_35_39_JR },
			        {"Age": "40-44", "Pecentage": population[k].P_40_44_JR },
			        {"Age": "45-49", "Pecentage": population[k].P_45_49_JR },
			        {"Age": "50-54", "Pecentage": population[k].P_50_54_JR },
			        {"Age": "55-59", "Pecentage": population[k].P_55_59_JR },
			        {"Age": "60-65", "Pecentage": population[k].P_60_65_JR },
			        {"Age": "65-69", "Pecentage": population[k].P_65_69_JR },
			        {"Age": "70-74", "Pecentage": population[k].P_70_74_JR },
			        {"Age": "75-79", "Pecentage": population[k].P_75_79_JR },
			        {"Age": "80-84", "Pecentage": population[k].P_80_84_JR },
			        {"Age": "85-89", "Pecentage": population[k].P_85_89_JR },
			        {"Age": "90-94", "Pecentage": population[k].P_90_94_JR },
			        {"Age": "95-EO", "Pecentage": population[k].P_95_EO_JR }
			    ];

			    chart.draw(1000);
				
				pieData = [
					{ label: "not married", value: Math.floor( population[k].P_ONGEHUWD), caption: "people who are not married" },
					{ label: "married", value: Math.floor( population[k].P_GEHUWD), caption: "people who are married" },
					{ label: "divorced", value: Math.floor( population[k].P_GESCHEID), caption: "people who are divorced" },
					{ label: "widow", value: Math.floor( population[k].P_VERWEDUW), caption: "people who are widowed" }
				];
				pieName = population[k].GM_NAAM;
			}
		}
		pie.updateProp( "data.content", pieData );
		pie.updateProp( "header.title.text", pieName );
	}

	function checkItem()
	{
		for(count=0;count<4;count++)
		{
			if (MyForm.item[count].checked)
			alert(MyForm.item[count].value+" is selected");
		}
	}
</script>
</body>
</html>
