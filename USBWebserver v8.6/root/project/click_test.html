<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style>
	path {
	  stroke: grey;
	  stroke-width: 1px;
	  fill: white;
	}

	path:hover {
  		fill: red;
	}

</style>

<body>

	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
	<script>
		var width = 800,
			height = 800;

		var cityData = d3.map();
		var ageData = d3.map();

		var linearColorScale = d3.scale.linear()
			.domain([0.0, 100.0])
			.range(["white", "blue"]);

		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height);

		// Setup the map projection for a good depiction of The Netherlands. The
		// projection is centered on the geographical center of the country, which
		// happens to be the city of Lunteren.
		var projection = d3.geo.albers()
			  .rotate([0, 0])
			  .center([5.6, 52.1])
			  .parallels([50, 53])
			  .scale(15000)
			  .translate([width/2,height/2]);

		var path = d3.geo.path().projection(projection);
		var population = [];
		var g = svg.append("g");
		var i = 0;

		queue()
		   .defer(d3.json, "cities-geometry.json")
		   .defer(d3.tsv, "cities-data.txt", function(d) 
		   	{
		   		population[i] = d;
		   		i++
		   		cityData.set(d.Code, +d.AUTO_TOT);
		   	})
		   .await(dataLoaded);


		function dataLoaded(error, mapData) 
		{
			var maxValue = d3.max(cityData.values());
			//console.log("The maximum value is " + maxValue);			
			linearColorScale.domain([0.0, maxValue]); 

			g.selectAll("path")
			.data(mapData.features).enter()
			.append("path")
			.attr("d", path)
			.style("fill", function(d) { return linearColorScale(cityData.get(d.gm_code)); })
			.on("mouseover", function(){d3.select(this)
				.style("fill", "green");})
    		.on("mouseout", function(){d3.select(this)
    			.style("fill", function(d) { return linearColorScale(cityData.get(d.gm_code)); }); })
			.on("mousedown", cityClick)
			.append("title").text(function(d) {return d.gm_naam + ", " +
			cityData.get(d.gm_code); });
		}

		function cityClick(d) {


			for( k = 0; k < population.length; k++ )
			{
				if( d.gm_code == population[k].GM_CODE)
				{
					console.log( "what the dee says, naam: " + d.gm_naam + " code: " + d.gm_code);
					console.log( "what the mee says, naam: " + population[k].GM_NAAM + " code: " + population[k].GM_CODE + " extra info: " + population[k].P_00_04_JR );
				}
			}
			
			/*
    		d3.select(this).transition()
        	.duration(1000)
        	.attr("r", 10)
      		.transition()
        	.delay(1000)
        	.attr("r", 40);
        	*/
		};

		/*
		var clicked =  function()
		{
		    console.log("naam: "); //considering dot has a title attribute
		}
		*/
	</script>
</body>
</html>
