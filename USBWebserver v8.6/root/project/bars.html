<!DOCTYPE html>
<meta charset="utf-8">

<style>
    .axis {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }
</style>

<html>


<body>


    <svg class="chart">
    </svg>

    <div class="log" />

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/queue.v1.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <script>
        var cityData = d3.map();

        var barWidth = 40;
        var width;
        var height = 200;

        queue()
           .defer(d3.json, "cities-geometry.json")
           .defer(d3.tsv, "cities-data.txt", function (d) {
               //var agevalues = {
               //    "P_00_04_JR": d.P_00_04_JR, "P_05_09_JR": d.P_05_09_JR,
               //    "P_10_14_JR": d.P_10_14_JR, "P_15_19_JR": d.P_15_19_JR,
               //    "P_20_24_JR": d.P_20_24_JR, "P_25_29_JR": d.P_25_29_JR,
               //    "P_30_34_JR": d.P_30_34_JR, "P_35_39_JR": d.P_35_39_JR,
               //    "P_40_44_JR": d.P_40_44_JR, "P_45_49_JR": d.P_45_49_JR,
               //    "P_50_54_JR": d.P_50_54_JR, "P_55_59_JR": d.P_55_59_JR,
               //    "P_60_64_JR": d.P_60_65_JR, "P_65_69_JR": d.P_65_69_JR,
               //    "P_70_74_JR": d.P_70_74_JR, "P_75_79_JR": d.P_75_79_JR,
               //    "P_80_84_JR": d.P_80_84_JR, "P_85_89_JR": d.P_85_89_JR,
               //    "P_90_94_JR": d.P_90_94_JR, "P_95_EO_JR": d.P_95_EO_JR
               //};

               var agevalues = d3.map();
               agevalues.set("P_00_04_JR", d.P_00_04_JR); agevalues.set("P_05_09_JR", d.P_05_09_JR);
               agevalues.set("P_10_14_JR", d.P_10_14_JR); agevalues.set("P_15_19_JR", d.P_15_19_JR);
               agevalues.set("P_20_24_JR", d.P_20_24_JR); agevalues.set("P_25_29_JR", d.P_25_29_JR);
               agevalues.set("P_30_34_JR", d.P_30_34_JR); agevalues.set("P_35_39_JR", d.P_35_39_JR);
               agevalues.set("P_40_44_JR", d.P_40_44_JR); agevalues.set("P_45_49_JR", d.P_45_49_JR);
               agevalues.set("P_50_54_JR", d.P_50_54_JR); agevalues.set("P_55_59_JR", d.P_55_59_JR);
               agevalues.set("P_60_64_JR", d.P_60_65_JR); agevalues.set("P_65_69_JR", d.P_65_69_JR);
               agevalues.set("P_70_74_JR", d.P_70_74_JR); agevalues.set("P_75_79_JR", d.P_75_79_JR);
               agevalues.set("P_80_84_JR", d.P_80_84_JR); agevalues.set("P_85_89_JR", d.P_85_89_JR);
               agevalues.set("P_90_94_JR", d.P_90_94_JR); agevalues.set("P_95_EO_JR", d.P_95_EO_JR);
               
               cityData.set(d.Code, agevalues);
           })
           .await(dataLoaded);


        var x;
        var y;

        var cityAgeData;

        function dataLoaded(error, mapData) {

            width = (barWidth + 10) * cityData.entries()[10].value.values().length;
            x = d3.scale.linear().domain([0, cityData.entries()[10].value.values().length]).range([0, width]);
            y = d3.scale.linear().domain([0, d3.max(cityData.entries()[10].value.values())]).rangeRound([0, height]);


            console.log("Width: " + width);

            //var maxValue = d3.max(cityData.values());
            //console.log("The maximum value is " + maxValue);
            //linearColorScale.domain([0.0, maxValue]);
            //g.selectAll("path")
            //.data(mapData.features).enter()
            //.append("path")
            //.attr("d", path)
            //.style("fill", function (d) { return linearColorScale(cityData.get(d.gm_code)); })
            //.append("title").text(function (d) {
            //    return d.gm_naam + ", " +
            //    cityData.get(d.gm_code);
            //});

            // Create a linear scale
            //x = d3.scale.linear()
            //.domain([0, d3.max(cityData.values())])
            //.range([0, 800]);

            //x = d3.scale.linear().domain([0, cityData.size()]).range([0, width]);

            console.log(cityData.entries()[10].value.values().length);

            //x = d3.scale.ordinal().rangeRoundBands([0, width], .05);

            //d3.select(".chart")
            //.selectAll("div")
            //.data(cityData.values())
            //.enter().append("div")
            //.style("width", function (d) { return x(d) + "px"; })
            //.text(function (d) { return d; });

            cityData.values().indexOf

            d3.select(".chart")
                .attr("width", width)
                .attr("height", height)
            .selectAll("rect")
            .data(cityData.entries()[10].value.values())
            .enter().append("rect")
            .style("fill", "steelblue")
            .attr("x", function (data, index) { console.log(index); return x(index); })
            .attr("y", function(d) { return height - y(d); })
            .attr("width", barWidth)
            .attr("height", height);

            //
            //.attr("width", x.rangeBand())
            //.attr("y", function (d) { return y(d.value); })
            //.attr("height", function (d) { return height - y(d.value); });
        };
</script>

</body>
</html>
