<!DOCTYPE html>
<html>
<meta charset="utf-8">
<style>
	path {
	  stroke: grey;
	  stroke-width: 1px;
	  fill: white;
	}

	path:hover {
  		fill: red;
	}

	.bar {
        fill: steelblue;
    }

    .axis text {
        font: 10px sans-serif;
    }

    .bar:hover {
        fill: brown;
    }

    .chart {
        position:absolute;
        top: 500px;
        right: 5px;
    }

    .axis {
        font: 10px sans-serif;
    }

    .axis path,
    .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
    }
</style>

<body>
    <svg class="chart" width="750" height="300"></svg>
    
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script src="http://d3js.org/queue.v1.min.js"></script>
	<script src="http://d3js.org/topojson.v1.min.js"></script>
    <script src="BarChartScript.js"></script>
	<script>
		var width = 1600,
			height = 800;

		var cityData = d3.map();
		var cityAgeData = d3.map();

		var linearColorScale = d3.scale.linear()
			.domain([0.0, 100.0])
			.range(["white", "blue"]);

		// Setup the map projection for a good depiction of The Netherlands. The
		// projection is centered on the geographical center of the country, which
		// happens to be the city of Lunteren.
		var projection = d3.geo.albers()
			  .rotate([0, 0])
			  .center([5.6, 52.1])
			  .parallels([50, 53])
			  .scale(15000)
			  .translate([width/4,height/2]);

		var svg = d3.select("body").append("svg")
			.attr("width", width)
			.attr("height", height);

		var g = svg.append("g");

		var path = d3.geo.path().projection(projection);
		var population = [];

		var i = 0;

		queue()
		   .defer(d3.json, "cities-geometry.json")
		   .defer(d3.tsv, "cities-data.txt", function(d) 
		   	{
		   		population[i] = d;
		   		i++
		   		cityData.set(d.Code, +d.AUTO_TOT);

                // Added to collect cityAgeData
		   		var agevalues = d3.map();
		   		agevalues.set("P_00_04_JR", d.P_00_04_JR); agevalues.set("P_05_09_JR", d.P_05_09_JR);
		   		agevalues.set("P_10_14_JR", d.P_10_14_JR); agevalues.set("P_15_19_JR", d.P_15_19_JR);
		   		agevalues.set("P_20_24_JR", d.P_20_24_JR); agevalues.set("P_25_29_JR", d.P_25_29_JR);
		   		agevalues.set("P_30_34_JR", d.P_30_34_JR); agevalues.set("P_35_39_JR", d.P_35_39_JR);
		   		agevalues.set("P_40_44_JR", d.P_40_44_JR); agevalues.set("P_45_49_JR", d.P_45_49_JR);
		   		agevalues.set("P_50_54_JR", d.P_50_54_JR); agevalues.set("P_55_59_JR", d.P_55_59_JR);
		   		agevalues.set("P_60_64_JR", d.P_60_65_JR); agevalues.set("P_65_69_JR", d.P_65_69_JR);
		   		agevalues.set("P_70_74_JR", d.P_70_74_JR); agevalues.set("P_75_79_JR", d.P_75_79_JR);
		   		agevalues.set("P_80_84_JR", d.P_80_84_JR); agevalues.set("P_85_89_JR", d.P_85_89_JR);
		   		agevalues.set("P_90_94_JR", d.P_90_94_JR); agevalues.set("P_95_EO_JR", d.P_95_EO_JR);
		   		cityAgeData.set(d.Code, agevalues);
		   	})
		   .await(dataLoaded);


		function dataLoaded(error, mapData) 
		{
			var maxValue = d3.max(cityData.values());
			linearColorScale.domain([0.0, maxValue]); 

			g.selectAll("path")
			.data(mapData.features).enter()
			.append("path")
			.attr("d", path)
			.style("fill", function(d) { return linearColorScale(cityData.get(d.gm_code)); })
			.on("mouseover", function(){d3.select(this)
			.style("fill", "green");})
    		.on("mouseout", function(){d3.select(this)
    		.style("fill", function(d) { return linearColorScale(cityData.get(d.gm_code)); }); })
			.on("mousedown", cityClick)
			.append("title").text(function(d) {return d.gm_naam + ", " +
			cityData.get(d.gm_code); });
		}

		function cityClick(d) {
		    draw(cityAgeData.get(d.gm_code));
		};

	</script>
</body>
</html>
